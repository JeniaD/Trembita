{% extends "base.html" %}

{% block title %} Головна - Трембіта {% endblock title %}

{% block menu %}
<div class="sidebar-menu__item sidebar-menu__item--active" onclick="window.location.href='/home'">
    <img src="{{ url_for('static', filename='svg/home.svg') }}" class="sidebar-menu__item-icon" /> Головна
</div>
<div class="sidebar-menu__item" onclick="window.location.href='/trending'">
    <img src="{{ url_for('static', filename='svg/explore.svg') }}" class="sidebar-menu__item-icon" /> Тренди
</div>
<div class="sidebar-menu__item" onclick="window.location.href='/notifications'">
    <img src="{{ url_for('static', filename='svg/notifications.svg') }}" class="sidebar-menu__item-icon" /> Сповіщення
</div>
<div class="sidebar-menu__item" onclick="window.location.href='/messages'">
    <img src="{{ url_for('static', filename='svg/messages.svg') }}" class="sidebar-menu__item-icon" /> Повідомлення
</div>
<div class="sidebar-menu__item" onclick="window.location.href='/profile'">
    <img src="{{ url_for('static', filename='svg/profile.svg') }}" class="sidebar-menu__item-icon" /> Профіль
</div>
<div class="sidebar-menu__item" onclick="window.location.href='/other'">
    <img src="{{ url_for('static', filename='svg/more.svg') }}" class="sidebar-menu__item-icon" /> Інше
</div>
{% endblock menu %}

{% block content %}
    <h1>Вітаємо у Трембіті{% if current_user.is_authenticated %}, {{ current_user.name }}{% endif %}!</h1>

    {% if current_user.is_authenticated %}
    <div class="octave">
        <img class="octave__author-logo" src="{{ url_for('static', filename='img/user-icon.png') }}" />
        <div class="octave__main">
            <div class="octave__header">
                <div class="octave__author-name"> {{ current_user.name }} </div>
                <div class="octave__author-slug"> @{{ current_user.username }} </div>
            </div>
            <div class="octave__content">
                <form id="postForm" method="post">
                    <input type="text" name="content" placeholder="Напишіть октаву...">
                    <button type="button" onclick="createPost()">Відправити</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function createPost() {
            const content = document.querySelector('input[name="content"]').value;
            if (!content) {
                alert("Октава пуста... :(");
                return;
            }

            const data = {
                content: content
            };

            // Make the AJAX POST request
            fetch("/post", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message); //alert(data.message); // Display the response from the server
                document.getElementById("postForm").reset(); // Clear the form

                location.reload(); // Warning: this is not correct
            })
            .catch(error => {
                console.error("Error:", error);
                alert("Помилка: " + error);
            });
        }
    </script>
    {% endif %}
    {% for octave in posts %}
        <div class="octave">
          <img class="octave__author-logo" src="{{ url_for('static', filename='img/user-icon.png') }}" />
          <div class="octave__main">
            <div class="octave__header">
              <div class="octave__author-name"> {{ octave.author.name }} </div>
              <div class="octave__author-slug"> @{{ octave.author.username }} </div>
              <div class="octave__publish-time">{{ octave.date.strftime("%d.%m.%Y %H:%M:%S") }}</div>
            </div>
            <div class="octave__content">{{ octave.content }}</div>
          </div>
        </div>
    {% endfor %}
{% endblock content %}

{% block trending %}
    <div class="trends-for-you__block">
        <div class="trends-for-you__meta-information"> Україна </div>
        <div class="trends-for-you__trend-name"> #Трембіта </div>
    </div>
    {% for trend in trending %}
        <div class="trends-for-you__block">
            <div class="trends-for-you__meta-information"> {{ trend.info }} </div>
            <div class="trends-for-you__trend-name"> {{ trend.name }} </div>
            <div class="trends-for-you__meta-information"> {{ trend.number }} </div>
        </div>
    {% endfor %}
{% endblock trending %}

{% block whoToFollow %}
    {% for rUser in recommendedUsers%}
        <div class="who-to-follow__block">
            <img class="who-to-follow__author-logo" src="{{ url_for('static', filename='img/user-icon.png') }}" />
            <div class="who-to-follow__content">
                <div>
                    <div class="who-to-follow__author-name"><a href="/profile/{{ rUser.username }}"> {{ rUser.name }} </a></div>
                    <div class="who-to-follow__author-slug"> @{{ rUser.username }} </div>
                </div>
                <div class="who-to-follow__button"> Стежити </div>
            </div>
        </div>
    {% endfor %}
{% endblock whoToFollow %}
