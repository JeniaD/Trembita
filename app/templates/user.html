{% extends "base.html" %}

{% block title %} Профіль {{ name }} - Трембіта {% endblock title %}

{% block menu %}
    <div class="sidebar-menu__item" onclick="window.location.href='/home'">
        <img src="{{ url_for('static', filename='svg/home.svg') }}" class="sidebar-menu__item-icon" /> Головна
    </div>
    <div class="sidebar-menu__item" onclick="window.location.href='/trending'">
        <img src="{{ url_for('static', filename='svg/explore.svg') }}" class="sidebar-menu__item-icon" /> Тренди
    </div>
    <div class="sidebar-menu__item" onclick="window.location.href='/notifications'">
        <img src="{{ url_for('static', filename='svg/notifications.svg') }}" class="sidebar-menu__item-icon" /> Сповіщення
    </div>
    <div class="sidebar-menu__item" onclick="window.location.href='/messages'">
        <img src="{{ url_for('static', filename='svg/messages.svg') }}" class="sidebar-menu__item-icon" /> Повідомлення
    </div>
    <div class="sidebar-menu__item" onclick="window.location.href='/profile'">
        <img src="{{ url_for('static', filename='svg/profile.svg') }}" class="sidebar-menu__item-icon" /> Профіль
    </div>
    <div class="sidebar-menu__item" onclick="window.location.href='/other'">
        <img src="{{ url_for('static', filename='svg/more.svg') }}" class="sidebar-menu__item-icon" /> Інше
    </div>
{% endblock menu %}

{% block content %}
    <img class="octave__author-logo" src="{{ url_for('main.UploadedAvatar', filename=user.id) }}" />
    <h1>{{ user.name }}{% if user.private %}&#x1F512;{% endif %}</h1>
    <span>@{{ user.username }}</span>
    {% if current_user.is_authenticated %}
        {% if current_user.IsSubscribed(user) %}
            <button id="subscribeButton">Відписатись</button>
        {% else %}
            <button id="subscribeButton">Підписатись</button>
        {% endif %}

        <script>
            const subscribeButton = document.getElementById('subscribeButton');
            // const unsubscribeButton = document.getElementById('unsubscribeButton');
            
            if (subscribeButton) {
                subscribeButton.addEventListener('click', function() {
                    const userID = {{ user.id }};
                    fetch('/subscribe', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ userID: userID })
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Handle the response as needed
                        console.log(data.message);
                    });
                });
            }
        
            // if (unsubscribeButton) {
            //     unsubscribeButton.addEventListener('click', function() {
            //         const userId = /* get the user ID */;
            //         fetch('/unsubscribe', {
            //             method: 'POST',
            //             headers: {
            //                 'Content-Type': 'application/json'
            //             },
            //             body: JSON.stringify({ user_id: userId })
            //         })
            //         .then(response => response.json())
            //         .then(data => {
            //             // Handle the response as needed
            //             console.log(data.message);
            //         });
            //     });
            // }
        </script>

        <!-- <form id="subscriptionForm" method="post">
            <input type="hidden" id="targetUsername" value="{{ user.username }}">
            <button id="subscribeButton" onclick="Subscribe()">{% if current_user.IsSubscribed(user) %} Відписатись {% else %} Підписатись {% endif %}</button>
        <!-- </form> -->
        <!-- <script>
            function Subscribe() {
                const target = document.getElementById("targetUsername").value;
                if (!target) { return; }

                const data = {
                    username: target
                };

                // Make the AJAX POST request
                fetch("/subscribe", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message); //alert(data.message); // Display the response from the server
                    document.getElementById("postForm").reset(); // Clear the form

                    location.reload(); // Warning: this is not correct
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("Помилка: " + error);
                });
            }
        </script> -->
    {% endif %}
    <br>
    <div>{{ user.about }}</div><br>
    <div>{{ user.followers.count() }} стежать, {{ user.following.count() }} стежить</div><br>

    {% if not private %}
        {% for post in posts %}
            <div class="octave">
                <img class="octave__author-logo" src="{{ url_for('static', filename='img/user-icon.png') }}" />
                <div class="octave__main">
                    <div class="octave__header">
                    <div class="octave__author-name"> {{ user.name }} </div>
                    <div class="octave__author-slug"> @{{ user.username }} </div>
                    <div class="octave__publish-time"> {{ post.date.strftime("%b %d, %Y") }} </div>
                    </div>
                    <div class="octave__content">
                    {{ post.content }}
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        Цей акаунт приватний
    {% endif %}
{% endblock content %}

{% block trending %}
{% endblock trending %}

{% block whoToFollow %}
    {% for user in users %}
        <div class="who-to-follow__block">
            <img class="who-to-follow__author-logo" src="{{ url_for('static', filename='img/user-icon.png') }}" />
            <div class="who-to-follow__content">
                <div>
                    <div class="who-to-follow__author-name"> {{ user.name }} </div>
                    <div class="who-to-follow__author-slug"> @{{ user.username }} </div>
                </div>
                <div class="who-to-follow__button"> Стежити </div>
            </div>
        </div>
    {% endfor %}
{% endblock whoToFollow %}
